"""
EvoForgePlus 工具模块

这个模块定义了智能体可用的工具函数，并提供了一个工具注册表（TOOL_REGISTRY）供其他模块调用。
工具函数是智能体与环境交互的接口，可以执行计算、数据处理、外部API调用等操作。

核心功能：
1. 提供基础工具函数（计算器、文本处理等）
2. 维护工具注册表，支持动态工具发现和调用
3. 确保工具函数的安全性和可靠性

扩展说明：
- 新增工具时需要在 TOOL_REGISTRY 中注册
- 工具函数应具有清晰的输入输出类型和错误处理
- 生产环境中应替换 eval() 等危险函数为安全实现
"""


def calculator(expression: str) -> str:
    """
    计算器工具函数
    
    执行简单的数学表达式计算，支持加减乘除等基本运算。
    这个工具主要用于演示智能体如何利用外部工具进行计算任务。
    
    参数:
        expression (str): 数学表达式字符串，如 "2 + 2 * 5"、"3.14 * 5^2"
        
    返回:
        str: 计算结果字符串，如 "12"、"78.5"
        
    注意:
        1. 生产环境中使用 eval() 是危险的，可能引发代码注入攻击
        2. 实际应用中应使用安全的表达式解析库，如 ast.literal_eval() 或专门的数学表达式解析器
        3. 这个实现仅用于演示目的，展示了智能体工具的基本工作原理
        
    异常处理:
        当表达式无法计算时，返回包含错误信息的字符串，而不是抛出异常，
        这确保了智能体的稳定性。
    """
    try:
        # ⚠️ 安全警告: 在生产环境中 eval() 是危险的，这里仅作演示
        # 实际应用中应使用安全的表达式解析库，如 ast.literal_eval() 或专门的数学表达式解析器
        return str(eval(expression))
    except Exception as e:
        # 计算出错时返回错误信息，而不是抛出异常
        # 这确保了智能体在工具失败时仍能继续运行
        return f"Calculation Error: {e}"


def text_length_counter(text: str) -> str:
    """
    文本长度计数器工具函数
    
    计算输入文本的字符长度（包括空格和标点），用于文本分析任务。
    
    参数:
        text (str): 输入文本字符串，可以是任意长度的文本
        
    返回:
        str: 文本长度字符串，如 "42"、"0"（空文本）
        
    使用场景:
        - 分析文本复杂度
        - 验证输入文本长度限制
        - 作为其他文本处理工具的基础
        
    注意:
        这个工具计算的是字符数（包括空格），而不是单词数或字节数。
        对于多字节字符（如中文），len() 返回的是字符数而非字节数。
    """
    return str(len(text))


# 工具注册表
# 通过字符串名称映射到对应的工具函数，便于智能体动态调用
TOOL_REGISTRY = {
    "calculator": calculator,           # 计算器工具
    "text_length_counter": text_length_counter  # 文本长度计数器工具
}

"""
工具注册表说明：

TOOL_REGISTRY 是一个全局字典，用于注册所有可用的工具函数。
其他模块（如 engine.py 中的 GraphAgent）可以通过工具名称来查找和调用对应的工具函数。

扩展方法：
1. 新增工具：定义新的工具函数，然后添加到 TOOL_REGISTRY 中
2. 移除工具：从 TOOL_REGISTRY 中删除对应的键值对
3. 工具分组：可以使用嵌套字典或命名空间来组织复杂的工具集合

最佳实践：
1. 工具名称应具有描述性且易于记忆
2. 每个工具函数应有清晰的文档字符串说明
3. 工具函数应处理所有可能的异常，返回字符串结果
4. 考虑工具的安全性，特别是当处理用户输入时
"""
